diff --git a/datapath/linux/Makefile.main.in b/datapath/linux/Makefile.main.in
index 6dcc8d0..a2c308d 100644
--- a/datapath/linux/Makefile.main.in
+++ b/datapath/linux/Makefile.main.in
@@ -2,8 +2,10 @@
 export builddir = @abs_builddir@
 export srcdir = @abs_srcdir@
 export top_srcdir = @abs_top_srcdir@
-export KSRC = @KBUILD@
+export KSRC = @KSRC@
+export KBUILD = @KBUILD@
 export VERSION = @VERSION@
+export CC = @CC@
 
 include $(srcdir)/../Modules.mk
 include $(srcdir)/Modules.mk
@@ -43,13 +45,7 @@ html:
 tags:
 TAGS:
 
-ifneq ($(KSRC),)
-
-ifeq (/lib/modules/$(shell uname -r)/source, $(KSRC))
-  KOBJ := /lib/modules/$(shell uname -r)/build
-else
-  KOBJ := $(KSRC)
-endif
+KOBJ := $(KBUILD)
 
 VERSION_FILE := $(KOBJ)/include/linux/version.h
 ifeq (,$(wildcard $(VERSION_FILE)))
